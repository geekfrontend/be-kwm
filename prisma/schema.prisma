generator client {
  provider = "prisma-client"
  output   = "./generated/client"
}

datasource db {
  provider = "mysql"
}

enum Role {
  ADMIN
  SECURITY
  EMPLOYEE
}

enum AttendanceStatus {
  ONTIME
  LATE
}

model User {
  id            String       @id @default(cuid())
  name          String
  email         String       
  password      String
  token         String?      @db.Text
  role          Role         @default(EMPLOYEE)
  isActive      Boolean      @default(true) @map("is_active")
  noHp          String       @unique
  ttl           String?      
  address       String?      @db.Text
  education     String? 
  startWorkDate String?      @map("start_work_date")
  position      String?
  nik           String?
  bpjsTk        String?      @map("bpjs_tk")
  bpjsKes       String?      @map("bpjs_kes")
  ketStatus     String?
  createdAt     DateTime     @default(now()) @map("created_at")
  updatedAt     DateTime     @updatedAt @map("updated_at")

  attendances   Attendance[]
  divisionId    String?      @map("division_id")
  division      Division?    @relation(fields: [divisionId], references: [id], onDelete: SetNull)

  @@index([divisionId])
  @@map("users")
}


model Attendance {
  id             String             @id @default(cuid())
  userId         String             @map("user_id")
  attendanceDate DateTime           @map("attendance_date") @db.Date

  checkInAt      DateTime?          @map("check_in_at")
  checkOutAt     DateTime?          @map("check_out_at")
  status         AttendanceStatus?  @map("status")

  createdAt      DateTime           @default(now()) @map("created_at")
  updatedAt      DateTime           @updatedAt @map("updated_at")

  user           User               @relation(fields: [userId], references: [id])

  mealAllowance  MealAllowance?

  @@unique([userId, attendanceDate])
  @@index([userId])
  @@map("attendances")
}

model Division {
  id          String   @id @default(cuid())
  name        String   @unique
  isActive    Boolean  @default(true) @map("is_active")
  keterangan  String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  users       User[]

  @@map("divisions")
}


model MealAllowance {
  id           String     @id @default(cuid())
  attendanceId String     @unique @map("attendance_id") 

  amount       Int        @map("amount")                 
  isEligible   Boolean    @default(true) @map("is_eligible")
  isPaid       Boolean    @default(false) @map("is_paid")
  paidAt       DateTime?  @map("paid_at")

  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")

  attendance   Attendance @relation(fields: [attendanceId], references: [id])

  @@map("meal_allowances")
}